<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Patagonia Royal Odyssey – Interactive Map</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-XQoYMqMTK8LvdlDXvXO1e3U1b0w36p5Z3E2f3v6t27M="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #app { display: grid; grid-template-columns: 320px 1fr; grid-template-rows: 100vh; }
    #sidebar { padding: 16px; border-right: 1px solid #e6e6e6; overflow: auto; }
    #map { height: 100vh; width: 100%; }
    h1 { font-size: 18px; margin: 0 0 8px; }
    .note { color: #555; font-size: 12px; margin-bottom: 12px; }
    .item { padding: 10px 8px; border-radius: 10px; cursor: pointer; display: grid; grid-template-columns: 28px 1fr; gap: 10px; align-items: center; }
    .item:hover { background: #f6f6f6; }
    .emoji { font-size: 22px; line-height: 1; }
    .title { font-weight: 600; }
    .dates { font-size: 12px; color: #666; }
    .legend { margin-top: 8px; font-size: 12px; color: #666; }
    .btns { display:flex; gap:8px; margin-top:10px; }
    button { background:#111; color:white; border:none; border-radius:10px; padding:8px 10px; font-weight:600; cursor:pointer; }
    button.secondary { background:#f1f1f1; color:#111; }
    .popup h3{ margin:0 0 6px; font-size:16px; }
    .popup .dates{ font-size:12px; color:#666; margin-bottom:8px; }
    .popup .desc{ font-size:13px; line-height:1.35; }
    @media (max-width: 900px){ #app{ grid-template-columns: 1fr; grid-template-rows: 40vh 60vh; } #sidebar{ border-right: none; border-bottom: 1px solid #e6e6e6; } }
  </style>
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <h1>Patagonia 2026 – Interactive Map</h1>
      <div class="note">Click a stop (or pick from the list) to view its itinerary details. Update the <b>stops</b> JSON to keep the site in sync with your latest plan.</div>
      <div id="list"></div>
      <div class="legend">Order is shown by the path line from 🌵 → 🗿.</div>
      <div class="btns">
        <button id="fit">Fit Route</button>
        <button class="secondary" id="togglePath">Toggle Path</button>
      </div>
    </aside>
    <div id="map"></div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j7kPupHkHfZ3G6HkUO5rK0vE1sE0pMB6+Z8Z1D8="
    crossorigin=""
  ></script>

  <script>
    // === DATA: update this array when itinerary changes ===
    const stops = [
      { key: 'atacama', name: 'Atacama Desert', emoji: '🌵',  lat: -22.91,  lng: -68.20, dates:'19–22 Jan', hotel:'Nayara Alto / Our Habitas / Awasi (tbc)',  desc:'Puritama Hot Springs; Geysers del Tatio sunrise; Rainbow Valley; Altiplanic Lagoons; Valley of the Moon; private stargazing.' },
      { key: 'ba', name: 'Buenos Aires', emoji: '💃🕺', lat: -34.60,  lng: -58.38, dates:'22–24 Jan', hotel:'Four Seasons / Alvear / Park Hyatt', desc:'VIP arrival; La Brigada lunch; Mercado San Telmo; tango with Mora Godoy; Felipe Pigna history; El Viejo Almacén balcony.'},
      { key: 'areco', name: 'San Antonio de Areco', emoji: '🤠',  lat: -34.25,  lng: -59.47, dates:'25 Jan', hotel:'Estancia La Bamba de Areco', desc:'Estancia asado; horseback/calesa; gaucho demos; private dinner with folk guitar & dance.' },
      { key: 'madryn', name: 'Puerto Madryn', emoji: '🐧',  lat: -42.77,  lng: -65.04, dates:'26 Jan', hotel:'Península Valdés Hotel', desc:'Luncheon with Dr. Pablo García Borboroglu; penguin & sea‑lion colonies; sunset dinner.' },
      { key: 'ushuaia', name: 'Ushuaia', emoji: '🧭',  lat: -54.80,  lng: -68.30, dates:'27–28 Jan', hotel:'Los Cauquenes', desc:'Zodiac for dolphins/whales; Beagle Channel cruise; museum; private dinner.'},
      { key: 'calafate', name: 'El Calafate & El Chaltén', emoji: '🧊',  lat: -50.34, lng: -72.27, dates:'29–30 Jan', hotel:'EOLO', desc:'Lago Argentino sunset; heli to Mirador de los Cóndores; Perito Moreno with Dr. Skvarca team.'},
      { key: 'tdp', name: 'Torres del Paine', emoji: '🏔️',  lat: -51.25,  lng: -72.35, dates:'31 Jan–2 Feb', hotel:'Awasi / Tierra Patagonia', desc:'Puma‑tracking; gaucho folk & payador; Big‑5 wildlife.' },
      { key: 'osorno', name: 'Osorno / Lake Llanquihue', emoji: '🌋',  lat: -41.32, lng: -72.99, dates:'3–7 Feb', hotel:'Hotel AWA', desc:'Colonos Route private lunch; artisans; Mapuche ceremony with Machi.'},
      { key: 'chiloe', name: 'Chiloé Island', emoji: '⛪',  lat: -42.48,  lng: -73.76, dates:'5–6 Feb', hotel:'Refugia Lodge', desc:'UNESCO churches; artisan workshops; fishing village walk; cozy dinner & overnight.' },
      { key: 'santiago', name: 'Santiago & Wine Valleys', emoji: '🍷',  lat: -33.45,  lng: -70.66, dates:'7–10 Feb (+15 Feb)', hotel:'Ritz‑Carlton; Casa Real Santa Rita or VIK', desc:'City culture; wine blending / Andean Museum or VIK tastings & spa.'},
      { key: 'rapanui', name: 'Easter Island (Rapa Nui)', emoji: '🗿',  lat: -27.15,  lng: -109.43, dates:'11–14 Feb', hotel:'Nayara Hangaroa', desc:'Tapati Festival; Tahai & Ahu Akivi; Rano Raraku & Ahu Tongariki; Orongo & Rano Kau; ceremony.' }
    ];

    // === MAP INIT ===
    const map = L.map('map', { worldCopyJump: true, preferCanvas: true }).setView([-41, -72], 4.8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Emoji icon helper
    const emojiIcon = (emoji) =>
      L.divIcon({
        html: `<div style="font-size:28px; filter: drop-shadow(0 1px 1px rgba(0,0,0,.35));">${emoji}</div>`,
        className: 'emoji-pin',
        iconSize: [28, 28],
        iconAnchor: [14, 14]
      });

    // Add markers & sidebar list
    const list = document.getElementById('list');
    const markers = [];
    stops.forEach((s, i) => {
      const m = L.marker([s.lat, s.lng], { icon: emojiIcon(s.emoji), title: s.name }).addTo(map);
      m.bindPopup(`<div class="popup"><h3>${s.emoji} ${s.name}</h3><div class="dates">${s.dates||''}</div><div class="desc">${s.desc||''}</div></div>`);
      markers.push(m);

      const row = document.createElement('div');
      row.className = 'item';
      row.innerHTML = `<div class="emoji">${s.emoji}</div><div><div class="title">${i+1}. ${s.name}</div><div class="dates">${s.dates||''}</div></div>`;
      row.onclick = () => { map.setView([s.lat, s.lng], s.key === 'rapanui' ? 7 : 6, { animate: true }); m.openPopup(); };
      list.appendChild(row);
    });

    // Draw route
    const latlngs = stops.map(s => [s.lat, s.lng]);
    const route = L.polyline(latlngs, { color: '#0a58ca', weight: 3, opacity: 0.9, dashArray: '6,6' }).addTo(map);
    const fit = () => map.fitBounds(route.getBounds(), { padding: [20,20] });
    fit();

    // Buttons
    document.getElementById('fit').onclick = fit;
    document.getElementById('togglePath').onclick = () => {
      if (map.hasLayer(route)) map.removeLayer(route);
      else route.addTo(map);
    };
  </script>
</body>
</html>
